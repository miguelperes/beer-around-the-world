(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(20),s=n.n(c),o=n(21),i=(n(46),n(15)),l=n(17),u=n(14),m=n.n(u),f=n(13),h=n(18),d=n(3),b=n(4),p=n(6),v=n(5),g=n(7),k=(n(49),n(22)),w=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).getLastLocationCoord=function(e){var t=e&&e.length;if(t>=1){var a=e[t-1];return[a.lat,a.lng]}return n.props.defaultCenter},n}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.pinLocations,a=t.pinByVenues;return r.a.createElement("div",{className:"vh-100 w-100 center"},r.a.createElement(k.a,{defaultCenter:this.getLastLocationCoord(null),defaultZoom:3},n&&n.map(function(t,n){return r.a.createElement(k.b,{key:n,anchor:[t.lat,t.lng],venueId:t.id,color:a?"rgb(0 0 0)":"rgb(239,194,12)",onClick:function(){return e.props.onMarkerClick(t.id)}})})))}}]),t}(a.Component);w.defaultProps={center:[-22.906847,-43.172897],zoom:0};var y=w,E=function(e){var t=e.handleClick,n=e.style;return r.a.createElement("button",{className:"absolute right-1 bg-transparent bn pa0 h2 w2",style:n,onClick:t},r.a.createElement("svg",{fill:"black",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),r.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"})))},x=function(e){var t=e.locationInfo,n=e.handleClose,a=t.venue_name,c=t.venue_icon,s=t.location;return r.a.createElement("header",{className:"flex justify-center items-center"},r.a.createElement("img",{className:"mv2 mr1",src:c.sm,alt:"Venue Icon"}),r.a.createElement("div",{className:"w-75 flex flex-column"},r.a.createElement("span",{className:"w-100 tc f3-ns f2-l b"},a),r.a.createElement("span",{className:"w-100 tc f7 mv1"},s.venue_city," - ",s.venue_state," -"," ",s.venue_country)),r.a.createElement(E,{handleClick:n}))},N=function(e){var t=e.locationInfo,n=e.handleClose,a=t.brewery_name,c=t.brewery_label,s=t.location;return r.a.createElement("header",{className:"flex justify-center items-center"},r.a.createElement("img",{className:"mv2 mr1",src:c,alt:"brewery Icon"}),r.a.createElement("div",{className:"w-75 flex flex-column"},r.a.createElement("span",{className:"w-100 tc f3-ns f2-l b"},a),r.a.createElement("span",{className:"w-100 tc f7 mv1"},s.brewery_city," - ",s.brewery_state," -"," ",s.brewery_country)),r.a.createElement(E,{handleClick:n}))},C=n(12),O=n.n(C),j=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).formatDate=function(e){return new Date(e).toDateString()},n}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this,t=this.props.checkins;return r.a.createElement("div",{className:"ml1 mt1 overflow-y-scroll h-75"},t.map(function(t,n){var a=t.beer,c=t.brewery;return r.a.createElement("div",{className:"flex flex-row mv2 ml2",key:n},r.a.createElement("img",{className:"db mw-15 h-auto",style:{maxWidth:"100px",maxHeight:"100px"},src:a.beer_label,alt:"Beer Label"}),r.a.createElement("div",{className:"ml2 flex flex-column",key:n},r.a.createElement("span",{className:"f4 b"},a.beer_name),r.a.createElement("span",{className:"f6 f5-l"},"Brewery: ",c.brewery_name," (",c.country_name,")"),r.a.createElement("span",{className:"f6 f5-l"},"Style: ",a.beer_style),r.a.createElement("span",{className:"f6 f5-l"},"Rating: ",0===t.rating_score?"-":"".concat(t.rating_score,"/5")),r.a.createElement("span",{className:"f6 f5-l"},"Date: ",e.formatDate(t.created_at))))}))}}]),t}(a.Component);j.protoTypes={checkins:O.a.array};var I=j,_=function(e){function t(){return Object(d.a)(this,t),Object(p.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.locationInfo,a=t.onClose,c=t.pinByVenues;return r.a.createElement("div",{className:"w-100 h-100 bg-white overflow-hidden",ref:function(t){return e.node=t},onKeyDown:this.handleKeyDown,tabIndex:0},c?r.a.createElement(x,{locationInfo:n.info,handleClose:a}):r.a.createElement(N,{locationInfo:n.info,handleClose:a}),r.a.createElement("hr",{className:"black br1"}),r.a.createElement(I,{checkins:n.checkins}))}}]),t}(a.Component),S=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(p.a)(this,(e=Object(v.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(e){n.props.display&&!n.node.contains(e.target)&&n.props.onClose()},n.handleKeyDown=function(e){"Escape"===e.key&&n.props.onClose()},n}return Object(g.a)(t,e),Object(b.a)(t,[{key:"componentWillMount",value:function(){document.addEventListener("mousedown",this.handleClick),document.addEventListener("touchstart",this.handleClick)}},{key:"componentDidUpdate",value:function(){this.node&&this.node.focus()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleClick),document.removeEventListener("touchstart",this.handleClick)}},{key:"render",value:function(){var e=this;return this.props.display?r.a.createElement("div",{className:"absolute absolute-fill w-100 w-40-l w-60-m h-75 h-50-l h-50-m ml-auto mr-auto z-999 bg-white outline-0 br2 overflow-hidden",style:{transform:"translate(-50%, -50%)",top:"50%",left:"50%"},ref:function(t){return e.node=t},onKeyDown:this.handleKeyDown,tabIndex:0},this.props.children):null}}]),t}(a.Component),D=n(35),L=n.n(D),B=n(23),U=n.n(B),P=50,M="https://api.untappd.com/v4",V="https://untappd.com/oauth/authenticate/?client_id=".concat("51A42382CDD0304673E52895BE8F7ADB3A2E05CF","&response_type=token&redirect_url=").concat("https://miguelperes.github.io/beer-around-the-world/");function W(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=n?function(e,t){return e+"&access_token=".concat(t,"&limit=").concat(P)}(n,t):function(e,t){return"".concat(M,"/user/checkins/").concat(e,"?access_token=").concat(t,"&limit=").concat(P)}(e,t);return U.a.get(a).then(function(e){return{nextPageUrl:e.data.response.pagination.next_url,checkins:e.data.response.checkins.items}},function(e){console.error(e)})}function A(e){return e.filter(K).reduce(q,{})}function F(e){return e.filter(R).reduce(H,{})}function z(e,t){return Object.entries(t).reduce(Y,e)}function T(){var e=window.innerWidth;return e<=450?"90%":e<=960?"55%":"35%"}function K(e){return e.venue!==[]&&e.venue.location}function R(e){var t=0!==e.brewery.location.lat||0!==e.brewery.location.lng;return e.brewery&&t}function q(e,t){var n=t.venue.venue_id;if(e.hasOwnProperty(n)){var a=e[n];return a.checkins=a.checkins.concat(t),e}return e[n]={info:Object(f.a)({},t.venue),checkins:[t]},e}function H(e,t){var n=t.brewery.brewery_id;if(e.hasOwnProperty(n)){var a=e[n];return a.checkins=a.checkins.concat(t),e}return e[n]={info:Object(f.a)({},t.brewery),checkins:[t]},e}function J(e,t){var n=Object(l.a)(t,2),a=n[0],r=n[1];if(e.hasOwnProperty(a)){var c=e[a].checkins;return e[a].checkins=c.concat(r.checkins),e}return e[a]=r,e}function Y(e,t){var n=Object(l.a)(t,2),a=n[0],r=n[1];if(e.hasOwnProperty(a)){var c=e[a].checkins;return e[a].checkins=c.concat(r.checkins),e}return e[a]=r,e}var Z=n(36),$=n.n(Z),G=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(p.a)(this,Object(v.a)(t).call(this,e))).onChange=function(e){return n.setState({username:e.target.value})},n.onFocus=function(){return n.setState({username:""})},n.onSubmit=function(e){e.preventDefault(),n.props.handleSubmit(n.state.username)},n.state={username:"Untappd username"},n}return Object(g.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props.isLoading;return r.a.createElement("div",{className:"flex flex-row justify-center items-center center mt2"},r.a.createElement("form",{className:"center",onSubmit:this.onSubmit},r.a.createElement("input",{type:"text",className:"ba b--black-20 pa1 mb1",value:this.state.username,onChange:this.onChange,onFocus:this.onFocus}),r.a.createElement("button",{className:"ml2 f7-ns f6-l link dim br2 ph3 pv2 mb2 dib white bn bg-black",onClick:this.onSubmit},"Find Beers!")),e&&r.a.createElement($.a,{className:"ml2 self-start",type:"spin",color:"#ffff00",height:30,width:30}))}}]),t}(a.Component),Q=n(37),X=function(e){var t=e.userInfo;return r.a.createElement("div",null,r.a.createElement("div",{className:"flex flex-row mb1",style:{display:"flex"}},r.a.createElement("img",{style:{maxWidth:"100px",maxHeight:"100px"},src:t.user_avatar,alt:"User Avatar"}),r.a.createElement("div",{className:"ml2 flex flex-column"},r.a.createElement("span",{className:"f4 b mb1"},"".concat(t.first_name," ").concat(t.last_name)),r.a.createElement("span",{className:"f6 f5-l"},"Total Check-ins: ",t.stats.total_checkins),r.a.createElement("span",{className:"f6 f5-l"},"Loaded Check-ins: ",t.totalCheckins),r.a.createElement("span",{className:"f6 f5-l"},"Beers: ",t.stats.total_beers),r.a.createElement("span",{className:"f6 f5-l"},"Badges: ",t.stats.total_badges))),r.a.createElement("hr",{className:"black br1"}))},ee=n(38),te=n.n(ee),ne=(n(101),function(e){var t=e.leftStateName,n=e.rightStateName,a=e.defaultValue,c=e.onToggle;return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{className:"mr2"},t),r.a.createElement(te.a,{defaultChecked:a,icons:!1,onChange:c}),r.a.createElement("span",{className:"ml2"},n))}),ae={bmBurgerButton:{position:"fixed",width:"36px",height:"30px",left:"3%",top:"2%"},bmBurgerBars:{background:"#373a47"},bmBurgerBarsHover:{background:"#a90000"},bmCrossButton:{height:"24px",width:"24px"},bmCross:{background:"#bdc3c7"},bmMenuWrap:{position:"fixed",height:"100%"},bmMenu:{background:"#373a47",padding:"0.1em 0.1em 0",fontSize:"1.15em"},bmMorphShape:{fill:"#373a47"},bmItemList:{color:"#b8b7ad",padding:"0.8em"},bmItem:{textDecoration:"none",marginBottom:"10px",color:"#d1d1d1",transition:"color 0.2s",outline:"none"},bmOverlay:{background:"rgba(0, 0, 0, 0.3)"}},re=function(e){var t=e.userInfo,n=e.onLogout,a=e.onPinToggle,c=e.defaultPinMethod;return r.a.createElement(Q.slide,Object.assign({styles:ae},e),t&&r.a.createElement(X,{userInfo:t}),t&&r.a.createElement(ne,{leftStateName:"Pin Breweries",rightStateName:"Pin Venues",onToggle:a,defaultValue:c}),t?r.a.createElement("button",{className:"mt3 br2",onClick:n},r.a.createElement("span",{className:"black"},"Logout")):r.a.createElement("a",{className:"",href:V},"Login"),r.a.createElement("div",{className:"absolute bottom-0",style:{color:"#b8b7ad","&:hover":{color:"#b8b7ad"}}},"created by"," ",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://www.twitter.com/miguelfox",style:{color:"inherit"}},"@miguelfox"),"\xa0/\xa0",r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"http://www.twitter.com/peresdev",style:{color:"inherit"}},"@peresdev")))},ce=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(p.a)(this,Object(v.a)(t).call(this))).loadUserPins=function(){var t=Object(h.a)(m.a.mark(function t(n){var a,r,c,s,o,i,l;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.state,r=a.token,c=a.userData,!(s=JSON.parse(localStorage.getItem(n)))){t.next=7;break}console.log("Using cached"),e.setState({venuesInfo:s.venuesInfo,breweriesInfo:s.breweriesInfo}),t.next=25;break;case 7:if(!c[n]){t.next=11;break}e.setState({venuesInfo:c[n].venuesInfo}),t.next=25;break;case 11:return e.setState({loadingCheckins:!0,checkinRequestError:!1}),t.next=14,W(n,r);case 14:if(!(o=t.sent)){t.next=24;break}return i=o.checkins,l=o.nextPageUrl,e.setUserData(n,A(i),F(i)),t.next=20,e.getNextCheckins(19,l,r);case 20:localStorage.setItem(n,JSON.stringify(e.state.userData[n])),e.setState(function(e){return{loggedUser:Object(f.a)({},e.loggedUser,{totalCheckins:e.loggedUser.totalCheckins+i.length})}}),t.next=25;break;case 24:e.setState({checkinRequestError:!0,loadingCheckins:!1});case 25:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e.selectPin=function(t){return e.setState({selectedLocation:t,showLocationDetails:!0})},e.closeLocationDetails=function(){return e.setState({showLocationDetails:!1})},e.setUserData=function(t,n,a){e.setState(function(e){var r=Object(f.a)({},e.userData);return r[t]=Object(f.a)({},r[t],{breweriesInfo:a,venuesInfo:n}),{userData:r,breweriesInfo:a,venuesInfo:n}})},e.logout=function(){e.props.history.push("/"),e.setState({token:null,loggedUser:null,venuesInfo:[]})},e.state={token:null,username:"Untappd username",loggedUser:null,userData:{},venuesInfo:{},breweriesInfo:{},selectedLocation:null,pinByVenues:!0,checkinRequestError:!1,loadingCheckins:!1,showLocationDetails:!1},e}return Object(g.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){var e=Object(h.a)(m.a.mark(function e(){var t,n,a,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=L.a.parse(this.props.location.hash),!(n=t.access_token)){e.next=8;break}return e.next=4,c=n,U.a.get(M+"/user/info?access_token=".concat(c)).then(function(e){return e.data.response.user},function(e){return e});case 4:a=e.sent,this.setState({token:n,loggedUser:Object(f.a)({},a,{totalCheckins:0})}),r=a.user_name,this.loadUserPins(r);case 8:case"end":return e.stop()}var c},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"getNextCheckins",value:function(){var e=Object(h.a)(m.a.mark(function e(t,n,a){var r,c,s,o,i=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=this.state.venuesInfo,c=this.state.breweriesInfo,s=n,o=m.a.mark(function e(){var n,o,l;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(i.state.username,a,s);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return","break");case 5:s=n.nextPageUrl,o=A(n.checkins),u=r,m=o,r=Object.entries(m).reduce(J,u),l=F(n.checkins),c=z(c,l),i.setState(function(e){return{venuesInfo:r,breweriesInfo:c,loggedUser:Object(f.a)({},e.loggedUser,{totalCheckins:e.loggedUser.totalCheckins+n.checkins.length})}}),t--;case 12:case"end":return e.stop()}var u,m},e)});case 4:if(!(t>0&&""!==s)){e.next=11;break}return e.delegateYield(o(),"t0",6);case 6:if("break"!==e.t0){e.next=9;break}return e.abrupt("break",11);case 9:e.next=4;break;case 11:this.setUserData(this.state.username,r,c),this.setState({loadingCheckins:!1});case 13:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.venuesInfo,a=t.breweriesInfo,c=t.pinByVenues,s=t.showLocationDetails,o=t.selectedLocation,i=t.loadingCheckins,u=c?n:a,m=Object.entries(u).map(function(e){var t=Object(l.a)(e,2),n=t[0],a=t[1];return{lat:a.info.location.lat,lng:a.info.location.lng,id:n}});return r.a.createElement("div",{className:"flex flex-column"},r.a.createElement("div",{className:"absolute z-1 w-100 flex"},r.a.createElement("div",{className:"Main-search-bar pa3 tc"},r.a.createElement("div",{className:"Main-search-bar-title tc f2-l f4"},"Beer Around the World!"),null===this.state.token&&r.a.createElement("a",{className:"f7 link dim br2 ph3 pv2 mb2 dib white bg-black",href:V},"Login"),null!==this.state.token&&r.a.createElement(G,{handleSubmit:this.loadUserPins,isLoading:i}),this.state.checkinRequestError&&r.a.createElement("div",{className:"center f7 f6-l dark-red mt1"},"(Error: Unable to get checkins)"))),r.a.createElement(re,{userInfo:this.state.loggedUser,onLogout:this.logout,width:T(),defaultPinMethod:this.state.pinByVenues,onPinToggle:function(){return e.setState(function(e){return{pinByVenues:!e.pinByVenues}})}}),r.a.createElement(S,{display:s,onClose:this.closeLocationDetails},r.a.createElement(_,{locationInfo:u[o],pinByVenues:c,onClose:this.closeLocationDetails})),r.a.createElement("div",{className:"h-100 w-100"},r.a.createElement(y,{pinLocations:m,pinByVenues:c,onMarkerClick:this.selectPin})))}}]),t}(a.Component),se=function(){return r.a.createElement(i.c,null,r.a.createElement(i.a,{path:"/",render:function(e){return r.a.createElement(ce,e)}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(o.a,null,r.a.createElement(se,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},41:function(e,t,n){e.exports=n(108)},46:function(e,t,n){},49:function(e,t,n){}},[[41,1,2]]]);
//# sourceMappingURL=main.8b6ae3b9.chunk.js.map